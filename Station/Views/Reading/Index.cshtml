@model IEnumerable<Station.Models.Reading>

@{
    Layout = "_Layout";
    ViewData["Title"] = "القراءات";
}

   


<div class="app-content content">
    <div class="content-overlay"></div>
    <div class="content-wrapper">
        <div class="content-header row">
            <div class="content-header-left col-12 mb-2 mt-1">
                <div class="breadcrumbs-top">
                        <div class="breadcrumb-wrapper d-none d-sm-block">
                        <ol class="breadcrumb p-0 mb-0 pl-1">
                            <li class="breadcrumb-item">
                                <a  asp-action="Index" asp-controller="Home"><i class="bx bx-home-alt"></i></a>
                            </li>
                            <li class="breadcrumb-item active">
                                القراءات
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
            <div class="content-body">
         
            <section id="column-selectors">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">
                                        Column selectors with Export and Print Options
                                    </h4>
                                </div>
                                <div class="card-body card-dashboard">
                                   
                                      <div class="heading-elements">
                            <ul class="list-inline mb-0 d-flex align-items-center">
                           
                                <li class="ml-2"><a asp-action="Create" class="btn btn-primary">اضافة</a></li>
                            </ul>
                        </div>
                                    <div class="table-responsive">
                                        <table class="table table-striped dataex-html5-selectors">
                                            <thead>
                                <tr>
                                    <th> النقظة</th>
                                    <th> العداد</th>
                                    <th> القراءة</th>
                                    <th>التاريخ</th>
                                                @if (User.IsInRole(clsRole.roleadmin))
                                                {
                                                    <th>الإجراءات</th>
                                                }
                                            </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@item.Item.Name</td>
                                        <td>@item.Meter.numberMeter</td>

                                        <td>@item.dateTime</td>
                                        <td>@item.CurrentRead</td>
                                                                                        @if (User.IsInRole(clsRole.roleadmin))
                                                    {
                                                        <td>
                                                            <a class="js-delete" data-id="@item.Id">
                                                <i class="bx bx-trash"></i>
                                            </a>
                                            <a asp-action="Edit" class="bx bx-edit js-edit" asp-route-id="@item.Id">
                                            </a>
                                        </td>}
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                
           </div>
                        </div>
                    </div>
                </section>
                   </div>
        </div>
    </div>

@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    $(document).ready(function () {
        $('.js-delete').on('click', function () {
            var btn = $(this);
            Swal.fire({
                title: 'هل أنت متأكد؟',
                text: "بمجرد الحذف، لن تتمكن من استعادة هذا العنصر!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'نعم، احذفه!',
                cancelButtonText: 'لا، إلغاء!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: '/Reading/Delete/' + btn.data('id'),
                        success: function () {
                            var itemContainer = btn.parents('tr');
                            itemContainer.addClass('animate__animated animate__zoomOut');
                            setTimeout(function () {
                                itemContainer.remove();
                            }, 1000);
                            Swal.fire(
                                'تم الحذف!',
                                'تم حذف العنصر بنجاح.',
                                'success'
                            );
                        },
                        error: function () {
                            Swal.fire(
                                'خطأ!',
                                'حدث خطأ ما!',
                                'error'
                            );
                        }
                    });
                } else {
                    Swal.fire(
                        'تم الإلغاء',
                        'العنصر الخاص بك في أمان!',
                        'info'
                    );
                }
            });
        });
    });

 

  

    function searchTable() {
        const searchValue = document.getElementById('searchInput').value.toLowerCase();
        const tableRows = document.querySelectorAll('#myTable tbody tr');

        tableRows.forEach(function (row) {
            const cells = row.querySelectorAll('td');
            let rowContainsSearchTerm = false;

            cells.forEach(function (cell) {
                if (cell.textContent.toLowerCase().includes(searchValue)) {
                    rowContainsSearchTerm = true;
                }
            });

            if (rowContainsSearchTerm) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });

        currentPage = 1;
        paginateTable();
    }

    document.addEventListener('DOMContentLoaded', function () {
        paginateTable();
    });
</script>
}

